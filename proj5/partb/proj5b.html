<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flow Matching from Scratch – Part B</title>
  <link rel="stylesheet" href="../styles.css" />
</head>

<!-- <body class="top-title"> -->

<body class="top-title theme-b">

  <canvas id="sky" aria-hidden="true"></canvas>

  <!-- Top nav bar -->
  <header class="site-header">
    <div class="content">
      <nav class="top-nav" aria-label="Project navigation">
        <a href="../../index.html" class="nav-logo">
          Home
        </a>
        <!-- <div class="top-nav__links">
          <a href="../parta/proj5a.html" class="nav-link">Part A</a>
          <a href="../partb/proj5b.html" class="nav-link">Part B</a>
        </div> -->
      </nav>
    </div>
  </header>

  <!-- Title + Part A / Part B buttons -->
  <div class="content big-title">
    <h1 class="title">Flow Matching</h1>

    <div class="project-switcher" aria-label="Jump to project parts">
      <a href="../parta/proj5a.html" class="project-switcher__button project-switcher__button--primary">
        Part A
      </a>
      <a href="../partb/proj5b.html" class="project-switcher__button">
        Part B
      </a>
    </div>
  </div>

  <!-- ===================================================== Part 1: Single-Step Denoising UNet ===================================================== -->
  <section class="content gold-glass writing-section">
    <h2 class="section-heading">Single-Step Denoising UNet</h2>

    <p>
      The UNet architecture can be decomposed into three components: a left encoder path that applies
      a sequence of downsampling blocks to shrink spatial resolution and expand channel dimensionality,
      a compact middle block that aggregates global context, and a right decoder path that restores
      spatial resolution through upsampling blocks. Skip connections transmit feature maps from each
      encoder stage to the matching decoder stage, ensuring that coarse semantic structure from deeper
      layers is combined with fine spatial detail preserved in earlier layers.
    </p>

    <figure class="unet-diagram">
      <img src="media/diagrams/unconditional_arch.png" alt="UNet architecture diagram" />
    </figure>

    <p>
      In the MNIST setting, this template is instantiated at three resolution levels. A small vocabulary
      of operations—convolutions with Batch Normalization and GELU activations, strided convolutions for
      downsampling, transposed convolutions for upsampling, flattening via average pooling, and
      channel-wise concatenation—is composed into the <code>ConvBlock</code>, <code>DownBlock</code>, and
      <code>UpBlock</code> modules shown below. During Part&nbsp;1, this UNet functions as a single-step
      denoiser: a clean 1×28×28 MNIST image is corrupted by Gaussian noise with standard deviation σ, and
      the network is trained with an MSE objective to predict the clean digit in a single forward pass.
    </p>

    <figure class="unet-diagram">
      <img src="media/diagrams/atomic_ops_new.png"
        alt="Atomic operations composing ConvBlock, DownBlock, and UpBlock" />
    </figure>

    <p>
      Varying the corruption level provides a controlled way to examine the limits of the model. Small
      σ produces mildly perturbed digits, whereas large σ yields images that approach pure noise. This
      parameter sweeps out the regimes in which recognizable structure persists and the regimes in which
      the network must effectively infer the digit from highly degraded evidence.
    </p>
  </section>


  <!-- ===================================================== Part 1.2: Using the UNet to Train a Denoiser ===================================================== -->

  <section class="content gold-glass writing-section">
    <h2 class="section-heading">1.2 Using the UNet to Train a Denoiser</h2>

    <p>
      The first visualization surveys how a fixed handwritten “7” responds to increasing noise levels.
      As σ moves from 0.0 to 1.0, sparse perturbations evolve into dense, irregular patterns that
      progressively obscure stroke geometry. Mid-range σ values maintain enough brightness structure for
      the digit to remain identifiable, whereas high σ values leave only faint residual cues. This
      sequence delineates the threshold beyond which the representation no longer contains usable
      information.
    </p>

    <figure>
      <img src="media/one/1.2/noising_process.png" alt="Sigma sweep for a fixed MNIST digit" />
      <figcaption>
        Noise-only σ sweep: rising noise gradually eliminates stroke structure until the image becomes
        visually indistinguishable from Gaussian noise.
      </figcaption>
    </figure>

    <p>
      A more detailed study compares the noisy input, the UNet’s reconstruction, and a pixelwise
      absolute-error heatmap at each σ. When σ is small, the reconstruction nearly matches the clean
      digit, and the error map is almost blank. At moderate σ, the network restores a coherent and
      well-formed “7” even though the input is heavily degraded, with remaining error concentrated
      around stroke boundaries where handwritten digits naturally vary. At the highest σ levels,
      reconstruction becomes increasingly speculative, and the error maps broaden to reflect the loss of
      reliable structure in the input.
    </p>

    <figure>
      <img src="media/one/1.2/single_digit_sigma_sweep.gif" alt="Noisy input, reconstruction, and error for varying sigma" />
      <figcaption>
        σ-sweep showing noisy input, denoised output, and reconstruction error. The UNet performs
        reliably while structural cues remain, but errors intensify as σ removes nearly all evidence of
        the underlying digit.
      </figcaption>
    </figure>

    <p>
      The final visualization extends this analysis from a single “7” to a small batch of digits. For
      each σ, columns correspond to different MNIST examples, while rows show aligned views such as
      noisy inputs and their corresponding denoised outputs. At low σ the three rows are nearly
      indistinguishable from the clean targets, confirming that mild corruption is corrected with
      minimal distortion. As σ increases, the noisy row becomes dominated by noise, yet the denoised
      row continues to display sharp and legible digits across a range of classes, illustrating that the
      behavior observed on the single “7” generalizes to a broader subset of the dataset.
    </p>

    <figure>
      <img src="media/one/1.2/digit_denoising_sigma_sweep.gif"
        alt="Multi-digit sigma sweep showing noisy and denoised digits for several classes" />
      <figcaption>
        Multi-digit σ-sweep: across several digit classes, the UNet consistently recovers clean,
        class-consistent shapes from increasingly corrupted inputs, mirroring the trends observed in
        the single-digit analysis.
      </figcaption>
    </figure>
  </section>



  <script src="../script.js" defer></script>
</body>

</html>